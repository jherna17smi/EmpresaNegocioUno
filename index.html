<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Business Finances</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root{
      --brand-blue:#0d6efd; /* Bootstrap primary */
      --brand-red:#dc3545;  /* Bootstrap danger */
      --brand-bg:#f6f8ff;
    }
    body{ background: var(--brand-bg); }
    .hero{
      background: linear-gradient(135deg, var(--brand-blue), #123a8c);
      color:#fff;
      padding: 3rem 1rem;
      border-bottom: 6px solid var(--brand-red);
    }
    .nav-pills .nav-link.active{
      background: var(--brand-red);
    }
    .card-cta{
      border-left: 6px solid var(--brand-red);
    }
    .table thead th{ background:#f1f4ff; }
    .badge-income{ background: var(--brand-blue);} 
    .badge-expense{ background: var(--brand-red);} 
    footer{ font-size:.9rem; }
    .sticky-footer{ position:sticky; top:100%; }
  </style>
</head>
<body>
  <header class="hero">
    <div class="container">
      <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-3">
        <div>
          <h1 class="display-5 fw-semibold mb-1">Business Finances</h1>
          <p class="mb-0 opacity-75">Track income, expenses, cash outflows, debit/credit accounts, AR/AP, and see your live balance sheet.</p>
        </div>
        <div class="d-flex gap-2">
          <button id="btnExport" class="btn btn-light btn-sm">Export Data (JSON)</button>
          <label class="btn btn-outline-light btn-sm mb-0">
            Import Data <input id="importFile" type="file" accept="application/json" hidden />
          </label>
        </div>
      </div>
      <div class="row g-3 mt-4">
        <div class="col-6 col-md-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="small text-muted">Total Income (MTD)</div>
              <div class="h4 mb-0" id="kpiIncome">$0</div>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="small text-muted">Total Expenses (MTD)</div>
              <div class="h4 mb-0" id="kpiExpenses">$0</div>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="small text-muted">Cash on Hand</div>
              <div class="h4 mb-0" id="kpiCash">$0</div>
            </div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="small text-muted">Net Result (MTD)</div>
              <div class="h4 mb-0" id="kpiNet">$0</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container py-4">
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pills-overview-tab" data-bs-toggle="pill" data-bs-target="#pills-overview" type="button" role="tab">Overview</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-transactions-tab" data-bs-toggle="pill" data-bs-target="#pills-transactions" type="button" role="tab">Transactions</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-accounts-tab" data-bs-toggle="pill" data-bs-target="#pills-accounts" type="button" role="tab">Debit/Credit Accounts</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-arap-tab" data-bs-toggle="pill" data-bs-target="#pills-arap" type="button" role="tab">AR / AP</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-balance-tab" data-bs-toggle="pill" data-bs-target="#pills-balance" type="button" role="tab">Balance Sheet</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-plan-tab" data-bs-toggle="pill" data-bs-target="#pills-plan" type="button" role="tab">Plan</button>
      </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
      <!-- OVERVIEW -->
      <section class="tab-pane fade show active" id="pills-overview" role="tabpanel">
        <div class="row g-4">
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Income vs. Expenses (This Month)</div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm align-middle">
                    <thead>
                      <tr>
                        <th>Metric</th>
                        <th class="text-end">Amount</th>
                        <th class="text-end">Notes</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><span class="badge badge-income">Income</span></td>
                        <td class="text-end" id="tblIncome">$0</td>
                        <td class="text-end">Collected sales & other income</td>
                      </tr>
                      <tr>
                        <td><span class="badge badge-expense">Expenses</span></td>
                        <td class="text-end" id="tblExpenses">$0</td>
                        <td class="text-end">Operating + cash outflows</td>
                      </tr>
                      <tr class="fw-semibold">
                        <td>Net (Income âˆ’ Expenses)</td>
                        <td class="text-end" id="tblNet">$0</td>
                        <td class="text-end"><span id="tblStatus" class="badge bg-secondary">OK</span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="alert card-cta mt-3" id="gapAdvice" role="alert">
                  When expenses are higher than income, this area will generate a plan to close the gap.
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Quick Add</div>
              <div class="card-body">
                <form id="quickAdd" class="row g-2">
                  <div class="col-12 col-md-3">
                    <select class="form-select" id="qaType" required>
                      <option value="income">Income</option>
                      <option value="expense">Expense</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-3">
                    <input type="number" step="0.01" class="form-control" id="qaAmount" placeholder="Amount" required />
                  </div>
                  <div class="col-12 col-md-4">
                    <input type="text" class="form-control" id="qaDesc" placeholder="Description" />
                  </div>
                  <div class="col-12 col-md-2 d-grid">
                    <button class="btn btn-primary" type="submit">Add</button>
                  </div>
                </form>
                <p class="small text-muted mt-2 mb-0">Use the Transactions tab for detailed entry (date, category, etc.).</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- TRANSACTIONS -->
      <section class="tab-pane fade" id="pills-transactions" role="tabpanel">
        <div class="row g-4">
          <div class="col-lg-4">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Add Transaction</div>
              <div class="card-body">
                <form id="txForm" class="row g-2">
                  <div class="col-12">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="txType" required>
                      <option value="income">Income</option>
                      <option value="expense">Expense</option>
                      <option value="cash_outflow">Cash Outflow</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <label class="form-label">Amount</label>
                    <input type="number" step="0.01" class="form-control" id="txAmount" required />
                  </div>
                  <div class="col-6">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-control" id="txDate" required />
                  </div>
                  <div class="col-12">
                    <label class="form-label">Category</label>
                    <input type="text" class="form-control" id="txCategory" placeholder="e.g., Sales, Rent, Utilities"/>
                  </div>
                  <div class="col-12">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-control" id="txDesc2" />
                  </div>
                  <div class="col-12 d-grid">
                    <button class="btn btn-primary" type="submit">Add Transaction</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="col-lg-8">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold d-flex justify-content-between align-items-center">
                <span>Transactions</span>
                <button class="btn btn-outline-secondary btn-sm" id="clearTx">Clear All</button>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover" id="txTable">
                    <thead>
                      <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th class="text-end">Amount</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ACCOUNTS -->
      <section class="tab-pane fade" id="pills-accounts" role="tabpanel">
        <div class="row g-4">
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Debit Accounts (Cash/Checking/Savings)</div>
              <div class="card-body">
                <form id="debitForm" class="row g-2">
                  <div class="col-6"><input id="debitName" class="form-control" placeholder="Account name" required /></div>
                  <div class="col-6"><input id="debitBal" type="number" step="0.01" class="form-control" placeholder="Balance" required /></div>
                  <div class="col-12 d-grid"><button class="btn btn-primary" type="submit">Add Debit Account</button></div>
                </form>
                <div class="table-responsive mt-3">
                  <table class="table table-sm" id="debitTable">
                    <thead><tr><th>Name</th><th class="text-end">Balance</th><th></th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Credit/Loan Accounts (Liabilities)</div>
              <div class="card-body">
                <form id="creditForm" class="row g-2">
                  <div class="col-6"><input id="creditName" class="form-control" placeholder="Account name" required /></div>
                  <div class="col-6"><input id="creditBal" type="number" step="0.01" class="form-control" placeholder="Balance" required /></div>
                  <div class="col-12 d-grid"><button class="btn btn-primary" type="submit">Add Credit Account</button></div>
                </form>
                <div class="table-responsive mt-3">
                  <table class="table table-sm" id="creditTable">
                    <thead><tr><th>Name</th><th class="text-end">Balance</th><th></th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- AR/AP -->
      <section class="tab-pane fade" id="pills-arap" role="tabpanel">
        <div class="row g-4">
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Accounts Receivable (Customers Owe You)</div>
              <div class="card-body">
                <form id="arForm" class="row g-2">
                  <div class="col-5"><input id="arName" class="form-control" placeholder="Customer" required /></div>
                  <div class="col-3"><input id="arAmt" type="number" step="0.01" class="form-control" placeholder="Amount" required /></div>
                  <div class="col-4"><input id="arDue" type="date" class="form-control" required /></div>
                  <div class="col-12 d-grid"><button class="btn btn-primary" type="submit">Add AR</button></div>
                </form>
                <div class="table-responsive mt-3">
                  <table class="table table-sm" id="arTable">
                    <thead><tr><th>Customer</th><th>Due</th><th class="text-end">Amount</th><th></th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white fw-semibold">Accounts Payable (You Owe Vendors)</div>
              <div class="card-body">
                <form id="apForm" class="row g-2">
                  <div class="col-5"><input id="apName" class="form-control" placeholder="Vendor" required /></div>
                  <div class="col-3"><input id="apAmt" type="number" step="0.01" class="form-control" placeholder="Amount" required /></div>
                  <div class="col-4"><input id="apDue" type="date" class="form-control" required /></div>
                  <div class="col-12 d-grid"><button class="btn btn-primary" type="submit">Add AP</button></div>
                </form>
                <div class="table-responsive mt-3">
                  <table class="table table-sm" id="apTable">
                    <thead><tr><th>Vendor</th><th>Due</th><th class="text-end">Amount</th><th></th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- BALANCE SHEET -->
      <section class="tab-pane fade" id="pills-balance" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-header bg-white fw-semibold">Balance Sheet (Live)</div>
          <div class="card-body">
            <div class="row g-4">
              <div class="col-md-4">
                <h6>Assets</h6>
                <ul class="list-group" id="assetsList"></ul>
              </div>
              <div class="col-md-4">
                <h6>Liabilities</h6>
                <ul class="list-group" id="liabList"></ul>
              </div>
              <div class="col-md-4">
                <h6>Summary</h6>
                <ul class="list-group">
                  <li class="list-group-item d-flex justify-content-between"><span>Total Assets</span><strong id="bsAssets">$0</strong></li>
                  <li class="list-group-item d-flex justify-content-between"><span>Total Liabilities</span><strong id="bsLiab">$0</strong></li>
                  <li class="list-group-item d-flex justify-content-between"><span>Owner's Equity</span><strong id="bsEquity">$0</strong></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PLAN -->
      <section class="tab-pane fade" id="pills-plan" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-header bg-white fw-semibold">Action Plan (Autoâ€‘Generated When Expenses > Income)</div>
          <div class="card-body">
            <div id="planContent">
              <p class="text-muted mb-0">Your personalized plan will appear here when monthly expenses exceed income.</p>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <footer class="bg-dark text-white py-3 mt-4 sticky-footer">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
      <div>Â© <span id="copyrightYear"></span> Business Finances-Jose A. Hernandez Soto â€” All Rights Reserved.</div>
      <div class="small">Theme: <span class="text-danger">Red</span> & <span class="text-primary">Blue</span></div>
    </div>
  </footer>

  <script>
    // ---- Simple store using localStorage ----
    const Store = {
      key: 'bf-data-v1',
      load(){
        try{ return JSON.parse(localStorage.getItem(this.key)) || { tx:[], debit:[], credit:[], ar:[], ap:[], cash:0 }; }catch(e){ return { tx:[], debit:[], credit:[], ar:[], ap:[], cash:0 }; }
      },
      save(data){ localStorage.setItem(this.key, JSON.stringify(data)); }
    };

    const state = Store.load();

    // ---- Helpers ----
    const fmt = n => (n||0).toLocaleString(undefined,{style:'currency',currency:'USD'});
    const sum = arr => arr.reduce((a,b)=>a+Number(b||0),0);
    const monthOf = d => new Date(d).getMonth();
    const thisMonth = new Date().getMonth();

    function calcMonthly(){
      const income = sum(state.tx.filter(t=>t.type==='income' && monthOf(t.date)===thisMonth).map(t=>+t.amount));
      const expenses = sum(state.tx.filter(t=>['expense','cash_outflow'].includes(t.type) && monthOf(t.date)===thisMonth).map(t=>+t.amount));
      return { income, expenses, net: income - expenses };
    }

    function calcCash(){
      const debitTotal = sum(state.debit.map(a=>+a.balance));
      const incomeAll = sum(state.tx.filter(t=>t.type==='income').map(t=>+t.amount));
      const outAll = sum(state.tx.filter(t=>['expense','cash_outflow'].includes(t.type)).map(t=>+t.amount));
      return debitTotal + incomeAll - outAll; // naive cash projection
    }

    function refreshKPIs(){
      const m = calcMonthly();
      document.getElementById('kpiIncome').textContent = fmt(m.income);
      document.getElementById('kpiExpenses').textContent = fmt(m.expenses);
      document.getElementById('kpiNet').textContent = fmt(m.net);
      document.getElementById('kpiCash').textContent = fmt(calcCash());

      document.getElementById('tblIncome').textContent = fmt(m.income);
      document.getElementById('tblExpenses').textContent = fmt(m.expenses);
      document.getElementById('tblNet').textContent = fmt(m.net);
      const status = document.getElementById('tblStatus');
      if(m.net < 0){ status.className='badge bg-danger'; status.textContent='Alert'; generatePlan(Math.abs(m.net)); }
      else { status.className='badge bg-success'; status.textContent='Healthy'; showGapAdviceDefault(); }
    }

    function showGapAdviceDefault(){
      document.getElementById('gapAdvice').className = 'alert card-cta mt-3 alert-info';
      document.getElementById('gapAdvice').textContent = 'You are net positive this month. Keep monitoring spend and accelerate collections to build a cash cushion.';
      document.getElementById('planContent').innerHTML = '<p class="text-muted mb-0">Your personalized plan will appear here when monthly expenses exceed income.</p>';
    }

    // ---- Plan generator ----
    function generatePlan(gap){
      const targetReduce = Math.ceil(gap * 0.6);
      const targetGrow = Math.ceil(gap * 0.4);
      const arTotal = sum(state.ar.map(a=>+a.amount));
      const apTotal = sum(state.ap.map(a=>+a.amount));

      document.getElementById('gapAdvice').className = 'alert card-cta mt-3 alert-danger';
      document.getElementById('gapAdvice').innerHTML = `Expenses exceed income by <strong>${fmt(gap)}</strong>. See the Action Plan tab for concrete steps.`;

      const plan = `
        <div class="row g-3">
          <div class="col-md-6">
            <div class="p-3 bg-light rounded-3 h-100">
              <h6 class="mb-2 text-danger">Cut or Delay Spend â€” Target ${fmt(targetReduce)}</h6>
              <ol class="mb-0">
                <li>Freeze nonâ€‘essential purchases for 30 days (<em>marketing tests, travel, subscriptions</em>).</li>
                <li>Renegotiate top vendors for a temporary 10â€“15% reduction. Current AP: <strong>${fmt(apTotal)}</strong>.</li>
                <li>Defer large cash outflows to next month where possible.</li>
              </ol>
            </div>
          </div>
          <div class="col-md-6">
            <div class="p-3 bg-light rounded-3 h-100">
              <h6 class="mb-2 text-primary">Boost Inflows â€” Target ${fmt(targetGrow)}</h6>
              <ol class="mb-0">
                <li>Collect receivables: call top 5 customers and offer 2%/10 net 30. Current AR: <strong>${fmt(arTotal)}</strong>.</li>
                <li>Prepayment incentive for new orders (5% off for upfront payment).</li>
                <li>Quick pricing review on lowâ€‘margin items (+2â€“3% increase).</li>
              </ol>
            </div>
          </div>
          <div class="col-12">
            <div class="alert alert-secondary mb-0"><strong>Goal:</strong> Close the gap of ${fmt(gap)} this month via ${fmt(targetReduce)} in expense cuts and ${fmt(targetGrow)} in accelerated inflows.</div>
          </div>
        </div>`;
      document.getElementById('planContent').innerHTML = plan;
    }

    // ---- Transactions table ----
    function renderTx(){
      const tbody = document.querySelector('#txTable tbody');
      tbody.innerHTML = '';
      state.tx.forEach((t,idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${t.date||''}</td>
          <td>${t.type.replace('_',' ')}</td>
          <td>${t.category||''}</td>
          <td>${t.desc||''}</td>
          <td class="text-end">${fmt(t.amount)}</td>
          <td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del="${idx}">Delete</button></td>`;
        tbody.appendChild(tr);
      });
    }

    // ---- Accounts tables ----
    function renderAccounts(){
      const dBody = document.querySelector('#debitTable tbody');
      const cBody = document.querySelector('#creditTable tbody');
      dBody.innerHTML = '';
      cBody.innerHTML = '';
      state.debit.forEach((a,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.name}</td><td class="text-end">${fmt(a.balance)}</td><td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del-debit="${i}">Delete</button></td>`;
        dBody.appendChild(tr);
      });
      state.credit.forEach((a,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.name}</td><td class="text-end">${fmt(a.balance)}</td><td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del-credit="${i}">Delete</button></td>`;
        cBody.appendChild(tr);
      });
    }

    // ---- AR / AP tables ----
    function renderARAP(){
      const arBody = document.querySelector('#arTable tbody');
      const apBody = document.querySelector('#apTable tbody');
      arBody.innerHTML = '';
      apBody.innerHTML = '';
      state.ar.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.name}</td><td>${r.due}</td><td class="text-end">${fmt(r.amount)}</td><td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del-ar="${i}">Delete</button></td>`;
        arBody.appendChild(tr);
      });
      state.ap.forEach((p,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.name}</td><td>${p.due}</td><td class="text-end">${fmt(p.amount)}</td><td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del-ap="${i}">Delete</button></td>`;
        apBody.appendChild(tr);
      });
    }

    // ---- Balance Sheet ----
    function renderBalance(){
      const assetsList = document.getElementById('assetsList');
      const liabList = document.getElementById('liabList');
      assetsList.innerHTML = '';
      liabList.innerHTML = '';

      const cash = calcCash();
      const arTotal = sum(state.ar.map(a=>+a.amount));
      const apTotal = sum(state.ap.map(a=>+a.amount));
      const debtTotal = sum(state.credit.map(a=>+a.balance));

      const assets = [ ['Cash & Equivalents', cash], ['Accounts Receivable', arTotal] ];
      const liab = [ ['Accounts Payable', apTotal], ['Debt / Credit', debtTotal] ];

      let assetsSum = 0, liabSum = 0;
      assets.forEach(([name,val])=>{ assetsSum+=val; const li = document.createElement('li'); li.className='list-group-item d-flex justify-content-between'; li.innerHTML=`<span>${name}</span><strong>${fmt(val)}</strong>`; assetsList.appendChild(li); });
      liab.forEach(([name,val])=>{ liabSum+=val; const li = document.createElement('li'); li.className='list-group-item d-flex justify-content-between'; li.innerHTML=`<span>${name}</span><strong>${fmt(val)}</strong>`; liabList.appendChild(li); });

      document.getElementById('bsAssets').textContent = fmt(assetsSum);
      document.getElementById('bsLiab').textContent = fmt(liabSum);
      document.getElementById('bsEquity').textContent = fmt(assetsSum - liabSum);
    }

    function saveAndRender(){
      Store.save(state);
      renderTx();
      renderAccounts();
      renderARAP();
      renderBalance();
      refreshKPIs();
    }

    // ---- Event listeners ----
    document.getElementById('quickAdd').addEventListener('submit', e=>{
      e.preventDefault();
      const type = document.getElementById('qaType').value;
      const amount = parseFloat(document.getElementById('qaAmount').value||0);
      const desc = document.getElementById('qaDesc').value;
      state.tx.push({ type, amount, date: new Date().toISOString().slice(0,10), category:'Quick Add', desc });
      e.target.reset();
      saveAndRender();
    });

    document.getElementById('txForm').addEventListener('submit', e=>{
      e.preventDefault();
      const t = {
        type: document.getElementById('txType').value,
        amount: parseFloat(document.getElementById('txAmount').value||0),
        date: document.getElementById('txDate').value,
        category: document.getElementById('txCategory').value,
        desc: document.getElementById('txDesc2').value
      };
      state.tx.push(t);
      e.target.reset();
      saveAndRender();
    });

    document.getElementById('txTable').addEventListener('click', e=>{
      const idx = e.target.getAttribute('data-del');
      if(idx!==null){ state.tx.splice(Number(idx),1); saveAndRender(); }
    });

    document.getElementById('clearTx').addEventListener('click', ()=>{ if(confirm('Delete all transactions?')){ state.tx = []; saveAndRender(); } });

    document.getElementById('debitForm').addEventListener('submit', e=>{
      e.preventDefault();
      state.debit.push({ name: document.getElementById('debitName').value, balance: parseFloat(document.getElementById('debitBal').value||0) });
      e.target.reset();
      saveAndRender();
    });

    document.getElementById('debitTable').addEventListener('click', e=>{
      const i = e.target.getAttribute('data-del-debit');
      if(i!==null){ state.debit.splice(Number(i),1); saveAndRender(); }
    });

    document.getElementById('creditForm').addEventListener('submit', e=>{
      e.preventDefault();
      state.credit.push({ name: document.getElementById('creditName').value, balance: parseFloat(document.getElementById('creditBal').value||0) });
      e.target.reset();
      saveAndRender();
    });

    document.getElementById('creditTable').addEventListener('click', e=>{
      const i = e.target.getAttribute('data-del-credit');
      if(i!==null){ state.credit.splice(Number(i),1); saveAndRender(); }
    });

    document.getElementById('arForm').addEventListener('submit', e=>{
      e.preventDefault();
      state.ar.push({ name: document.getElementById('arName').value, amount: parseFloat(document.getElementById('arAmt').value||0), due: document.getElementById('arDue').value });
      e.target.reset();
      saveAndRender();
    });

    document.getElementById('arTable').addEventListener('click', e=>{
      const i = e.target.getAttribute('data-del-ar');
      if(i!==null){ state.ar.splice(Number(i),1); saveAndRender(); }
    });

    document.getElementById('apForm').addEventListener('submit', e=>{
      e.preventDefault();
      state.ap.push({ name: document.getElementById('apName').value, amount: parseFloat(document.getElementById('apAmt').value||0), due: document.getElementById('apDue').value });
      e.target.reset();
      saveAndRender();
    });

    document.getElementById('apTable').addEventListener('click', e=>{
      const i = e.target.getAttribute('data-del-ap');
      if(i!==null){ state.ap.splice(Number(i),1); saveAndRender(); }
    });

    // ---- Export / Import ----
    document.getElementById('btnExport').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'business-finances-data.json'; a.click();
      URL.revokeObjectURL(url);
    });
    document.getElementById('importFile').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = (ev)=>{
        try{ const data = JSON.parse(ev.target.result); Object.assign(state, data); saveAndRender(); }
        catch(err){ alert('Invalid JSON file.'); }
      };
      reader.readAsText(file);
    });

    // ---- Init ----
    document.getElementById('copyrightYear').textContent = new Date().getFullYear();
    saveAndRender();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>